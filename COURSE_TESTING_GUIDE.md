# PeerSpark Course System - Quick Start Testing Guide

## Overview

The complete course system is now implemented with 18 API endpoints, 6 UI components, and full database schema. This guide helps you test the implementation.

---

## Prerequisites

1. **Appwrite Setup**
   ```bash
   # Run the setup script to create collections
   node scripts/setup-courses.js
   ```

2. **Environment Variables** - Create `.env.local`
   ```env
   # Appwrite
   APPWRITE_ENDPOINT=http://localhost/v1
   APPWRITE_PROJECT_ID=peerspark-main-db
   APPWRITE_DATABASE_ID=peerspark-main-db
   APPWRITE_API_KEY=your_api_key

   # AI Models
   OPENROUTER_API_KEY=your_openrouter_key

   # Stripe (optional)
   STRIPE_SECRET_KEY=sk_test_...
   NEXT_PUBLIC_STRIPE_PUBLIC_KEY=pk_test_...

   # App
   NEXT_PUBLIC_APP_URL=http://localhost:3000
   ```

3. **Install Dependencies**
   ```bash
   npm install stripe pdfkit qrcode youtube-transcript-api
   ```

---

## Testing Flows

### 1. Video Processing & Course Creation

**Test Endpoint**:
```bash
curl -X POST http://localhost:3000/api/courses/process-video \
  -H "Content-Type: application/json" \
  -d '{
    "youtubeLink": "https://www.youtube.com/watch?v=VIDEO_ID",
    "courseId": "test-course-1",
    "instructorId": "instructor-123",
    "courseTitle": "My First Course"
  }'
```

**Expected Response**:
```json
{
  "success": true,
  "courseId": "test-course-1",
  "chapters": [
    {
      "title": "Introduction",
      "description": "...",
      "learningObjectives": [...],
      "duration": 240
    }
  ]
}
```

**What Happens**:
- ‚úÖ Transcript extracted from YouTube
- ‚úÖ Transcript cleaned and chunked (300-800 tokens)
- ‚úÖ Chapter titles generated by AI
- ‚úÖ Learning objectives created
- ‚úÖ Data saved to COURSE_CHAPTERS collection

---

### 2. Content Generation

**Test Endpoint**:
```bash
curl -X POST http://localhost:3000/api/courses/generate-content \
  -H "Content-Type: application/json" \
  -d '{
    "courseId": "test-course-1",
    "contentType": "all",
    "chapters": ["chapter-1", "chapter-2"]
  }'
```

**What Gets Generated**:
- ‚úÖ 2-3 summaries per chapter (Llama-3.2-3b)
- ‚úÖ Detailed notes with concepts, formulas, applications (Mistral-7b)
- ‚úÖ 3 assignments per chapter (Easy MC, Medium, Hard Essay)
- ‚úÖ All saved to COURSE_CONTENT collection
- ‚úÖ Batch processed for cost optimization

---

### 3. Assignment Submission & Grading

**Submit Assignment**:
```bash
curl -X POST http://localhost:3000/api/assignments/submit \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student-123",
    "courseId": "test-course-1",
    "chapterId": "chapter-1",
    "assignmentId": "assignment-1",
    "answerText": "The answer is..."
  }'
```

**What Happens**:
- ‚úÖ Answer validated (10-10,000 characters)
- ‚úÖ Saved to ASSIGNMENT_SUBMISSIONS
- ‚úÖ Auto-grades via AI grading endpoint
- ‚úÖ Returns grade, confidence, and feedback

**Check Grade**:
```bash
curl http://localhost:3000/api/assignments/submit?submissionId=submission-123
```

---

### 4. Pod Course Assignment

**Assign Course to Pod**:
```bash
curl -X POST http://localhost:3000/api/pods/assign-course \
  -H "Content-Type: application/json" \
  -d '{
    "courseId": "test-course-1",
    "podId": "pod-123",
    "cohortName": "Tech Learners",
    "cohortPace": "Weekly"
  }'
```

**What Happens**:
- ‚úÖ Course linked to pod in POD_COURSES collection
- ‚úÖ All pod members auto-enrolled
- ‚úÖ Activities collection created
- ‚úÖ Progress tracking enabled

**Check Pod Progress**:
```bash
curl http://localhost:3000/api/pods/course-progress?podCourseId=RETURNED_ID
```

---

### 5. Pod Collaboration Features

**Create Discussion**:
```bash
curl -X POST http://localhost:3000/api/pods/course-chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student-123",
    "userName": "Alice",
    "podCourseId": "pod-course-id",
    "chapterId": "chapter-1",
    "content": "I have a question about...",
    "messageType": "question"
  }'
```

**Schedule Study Session**:
```bash
curl -X POST http://localhost:3000/api/pods/study-sessions \
  -H "Content-Type: application/json" \
  -d '{
    "podCourseId": "pod-course-id",
    "topic": "Chapter 1 Review",
    "scheduledStartTime": "2026-01-16T18:00:00Z",
    "hostId": "student-123",
    "hostName": "Alice"
  }'
```

---

### 6. Instructor Dashboard

**View Dashboard**:
```bash
curl http://localhost:3000/api/instructor/dashboard?instructorId=instructor-123
```

**Check Grading Queue**:
```bash
curl http://localhost:3000/api/instructor/grading-queue?instructorId=instructor-123&courseId=test-course-1
```

**Submit Manual Grade**:
```bash
curl -X POST http://localhost:3000/api/instructor/grading-queue \
  -H "Content-Type: application/json" \
  -d '{
    "submissionId": "submission-123",
    "instructorId": "instructor-123",
    "grade": 92,
    "feedback": "Excellent work! The answer shows..."
  }'
```

---

### 7. Social Feed & Achievements

**Post Achievement**:
```bash
curl -X POST http://localhost:3000/api/feed/course-achievements \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "student-123",
    "userName": "Alice",
    "courseId": "test-course-1",
    "courseName": "My First Course",
    "postType": "achievement",
    "achievementData": {
      "achievementType": "COURSE_COMPLETE",
      "points": 200,
      "badge": "üèÜ",
      "description": "Completed entire course with 85% average"
    }
  }'
```

**Get Trending Courses**:
```bash
curl http://localhost:3000/api/feed/trending-courses?timeframe=month&limit=10
```

---

### 8. User Profile

**View Learning Profile**:
```bash
curl http://localhost:3000/api/users/course-profile?userId=student-123
```

**Response Includes**:
- ‚úÖ Enrolled courses
- ‚úÖ Completed courses
- ‚úÖ Earned certificates
- ‚úÖ Achievements & badges
- ‚úÖ Learning statistics
- ‚úÖ Completion streaks

---

## Full Test Scenario

**Recommended Testing Order**:

1. **Create Course** (process-video)
   - Input: YouTube video link
   - Output: Course with 5-10 chapters

2. **Generate Content** (generate-content)
   - Input: Course chapters
   - Output: Summaries, notes, assignments

3. **Enroll Student** (simulate via database)
   - Create COURSE_ENROLLMENTS record manually

4. **Student Submits Work** (submit assignment)
   - Input: Course, chapter, answer
   - Output: Grade + feedback

5. **Create Pod & Assign** (assign-course)
   - Input: Pod ID + course
   - Output: Auto-enrolled members

6. **Pod Collaborates** (chat + study sessions)
   - Create discussions
   - Schedule group sessions

7. **Share Achievement** (course-achievements)
   - Post completion to feed
   - Verify in trending courses

8. **Check Instructor View** (dashboard)
   - View all analytics
   - Check grading queue

---

## Debugging Tips

### 1. Check Collection Exists
```javascript
// In Appwrite console
GET /databases/{DATABASE_ID}/collections/courses
```

### 2. View Recent Documents
```bash
curl http://localhost:3000/api/courses/list-all
```

### 3. Test Database Connection
```bash
// Check env variables
console.log(process.env.APPWRITE_ENDPOINT)
console.log(process.env.APPWRITE_DATABASE_ID)
```

### 4. Enable Logging
Add to API routes:
```typescript
console.log('Request received:', JSON.stringify(body));
console.log('Response sending:', JSON.stringify(result));
```

### 5. Check Error Messages
All endpoints return detailed error messages:
```json
{
  "error": "Specific error description"
}
```

---

## Common Issues & Solutions

### Issue: "Collection not found"
**Solution**: Run `node scripts/setup-courses.js` first

### Issue: "Transcript unavailable"
**Solution**: 
- Video must have captions/transcripts enabled
- Try different YouTube video
- Check `youtube-transcript-api` still works

### Issue: "API rate limit"
**Solution**:
- OpenRouter has free tier limits
- Add delays between requests
- Use batch processing

### Issue: "Database connection failed"
**Solution**:
- Verify Appwrite is running
- Check `APPWRITE_ENDPOINT` is correct
- Verify `APPWRITE_API_KEY` has permissions

---

## Performance Targets

- **Video Processing**: <5 min for 60-min video
- **Content Generation**: <1 min per chapter
- **Assignment Grading**: <10 seconds per submission
- **API Response**: <500ms typical
- **Database Query**: <100ms for most operations

---

## Next Steps

1. ‚úÖ All backend APIs complete - start UI component development
2. ‚úÖ Create course listing page
3. ‚úÖ Build instructor dashboard UI
4. ‚úÖ Implement payment flow
5. ‚úÖ Write comprehensive tests
6. ‚úÖ Deploy to production

---

For detailed API documentation, see: [COURSE_SYSTEM_IMPLEMENTATION.md](./COURSE_SYSTEM_IMPLEMENTATION.md)
